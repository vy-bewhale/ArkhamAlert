<!-- @marker README.md -->
# Руководство по Фильтрации Транзакций в API Arkham

## Введение

Этот документ описывает поведение различных параметров фильтрации при запросе транзакций через API Arkham (`/transfers`). Понимание этих нюансов критически важно для корректного формирования запросов и получения ожидаемых результатов. Данные основаны на серии эмпирических тестов.

## Ключевые Рекомендации для Строгой Фильтрации по Адресам

*   **Для строгой фильтрации по одному или нескольким конкретным адресам (отправителя или получателя) всегда используйте параметры `from` или `to`.**
*   Параметры `fromAddresses` и `toAddresses` осуществляют **нестрогую (расширенную)** фильтрацию, вероятно, на уровне связанных сущностей (entities). Используйте их с осторожностью, если вам нужна фильтрация по конкретным кошелькам, так как они могут вернуть транзакции, где указанные вами адреса не являются прямыми участниками.

## Детальное Поведение Параметров Фильтрации

### 1. Параметры `from` и `to` (Строгая фильтрация)

Эти параметры предназначены для фильтрации транзакций по **конкретным адресам** отправителя (`from`) или получателя (`to`).

#### 1.1. Один адрес

*   **Описание:** Возвращает транзакции, где указанный адрес является непосредственным отправителем (для `from`) или получателем (для `to`).
*   **Пример запроса (отправитель):**
    ```json
    {
        "from": "0xAddressA",
        "limit": 10,
        "timeLast": "1d",
        "usdGte": 1000000
    }
    ```
*   **Результат:** Транзакции, где `0xAddressA` был прямым отправителем.

#### 1.2. Несколько адресов ОДНОЙ сети (строка через запятую)

*   **Описание:** Возвращает транзакции, где отправителем (для `from`) или получателем (для `to`) является **любой** из перечисленных адресов. Фильтрация строгая по указанным адресам (логика "ИЛИ").
*   **Пример запроса (отправители из сети Ethereum):**
    ```json
    {
        "from": "0xEthAddress1,0xEthAddress2,0xEthAddress3",
        "limit": 10,
        "timeLast": "1d",
        "usdGte": 1000000
    }
    ```
*   **Результат:** Транзакции, где отправителем был `0xEthAddress1` ИЛИ `0xEthAddress2` ИЛИ `0xEthAddress3`.

#### 1.3. Несколько адресов РАЗНЫХ сетей (строка через запятую)

*   **Описание:** API **корректно обрабатывает** список адресов из разных сетей, переданных в одной строке через запятую. Фильтрация строгая по указанным адресам, работает по принципу "ИЛИ". Ошибка 500 **не возникает**.
*   **Пример запроса (отправители из Ethereum и Bitcoin):**
    ```json
    {
        "from": "0xEthAddress1,bc1BitcoinAddress1,TRONAddress1",
        "limit": 10,
        "timeLast": "1d",
        "usdGte": 100000000
    }
    ```
*   **Результат:** Транзакции, где отправителем был `0xEthAddress1` ИЛИ `bc1BitcoinAddress1` ИЛИ `TRONAddress1`.

#### 1.4. Одновременное использование `from` и `to`

*   **Описание:** Возвращает транзакции, которые были отправлены **строго от** адреса, указанного в `from`, **строго к** адресу, указанному в `to` (логика "И").
*   **Пример запроса:**
    ```json
    {
        "from": "0xAddressA",
        "to": "0xAddressB",
        "limit": 10,
        "timeLast": "1d",
        "usdGte": 1000000
    }
    ```
*   **Результат:** Транзакции от `0xAddressA` к `0xAddressB`.

### 2. Параметры `fromAddresses` и `toAddresses` (Нестрогая/Расширенная фильтрация)

*   **Описание:** Эти параметры осуществляют **нестрогую (расширенную)** фильтрацию. Вместо фильтрации по конкретно указанным адресам, API, вероятно, находит сущности (entities), с которыми связаны эти адреса, и возвращает транзакции, относящиеся ко всем адресам этих сущностей.
*   **ПРЕДУПРЕЖДЕНИЕ:** Если вам нужна точная фильтрация по заданным кошелькам, **не используйте `fromAddresses` / `toAddresses`**. Результаты могут включать транзакции, где указанные вами адреса не являются прямыми отправителями или получателями.
*   **Пример запроса:**
    ```json
    {
        "fromAddresses": "0xAddressA", 
        "limit": 10,
        "timeLast": "1d",
        "usdGte": 100000000
    }
    ```
*   **Результат:** Могут вернуться транзакции от адреса `0xAddressC`, если Arkham считает, что `0xAddressA` и `0xAddressC` принадлежат одной сущности.

### 3. Параметр `base`

Параметр `base` используется для фильтрации транзакций, где указанный адрес или сущность является *любым* участником (отправителем или получателем).

#### 3.1. Один адрес или ID сущности

*   **Описание:** Возвращает транзакции, где указанный адрес или ID сущности (например, "binance") является либо отправителем, либо получателем.
*   **Пример запроса (адрес):**
    ```json
    {
        "base": "0xAddressA",
        "limit": 10
    }
    ```
*   **Пример запроса (ID сущности):**
    ```json
    {
        "base": "binance",
        "limit": 10
    }
    ```

#### 3.2. `base` с параметром `flow`

*   **Описание:** Позволяет уточнить направление транзакций для указанной `base` сущности или адреса.
    *   `flow: "in"`: Только входящие транзакции на `base`.
    *   `flow: "out"`: Только исходящие транзакции с `base`.
*   **Пример запроса (входящие на Binance):**
    ```json
    {
        "base": "binance",
        "flow": "in",
        "limit": 10
    }
    ```

#### 3.3. `base` с несколькими адресами ОДНОЙ сети (строка через запятую)

*   **Описание:** Должен работать аналогично `from`/`to`, возвращая транзакции, где любой из указанных адресов является участником (логика "ИЛИ").
*   **Пример запроса:**
    ```json
    {
        "base": "0xEthAddress1,0xEthAddress2",
        "limit": 10
    }
    ```

#### 3.4. `base` с несколькими адресами РАЗНЫХ сетей (строка через запятую)

*   **Описание:** В ходе тестов было выявлено, что передача строки адресов из разных сетей в параметр `base` **приводит к ошибке API (статус 500)**. Это поведение отличается от параметров `from`/`to`.
*   **Пример запроса (ожидается ошибка):**
    ```json
    {
        "base": "0xEthAddress1,bc1BitcoinAddress1",
        "limit": 10
    }
    ```

## Заключение

Для наиболее предсказуемой и строгой фильтрации транзакций по конкретным адресам рекомендуется использовать параметры `from` и `to`. Они корректно обрабатывают как одиночные адреса, так и списки адресов (переданные строкой через запятую), в том числе из разных сетей, без вызова ошибок и с четкой логикой "ИЛИ".

Использование `fromAddresses` / `toAddresses` требует понимания, что фильтрация будет расширенной и может не соответствовать ожиданиям поиска по точному адресу. Параметр `base` полезен для отслеживания общей активности адреса/сущности, но имеет ограничения при работе со списками адресов из разных сетей. 